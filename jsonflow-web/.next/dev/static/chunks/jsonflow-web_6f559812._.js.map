{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/Coding/project/json-flow/jsonflow-web/features/shared/components/ThemeToggle.tsx"],"sourcesContent":["\"use client\";\n\nimport { FiMoon, FiSun } from \"react-icons/fi\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\n\nexport default function ThemeToggle() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <button\n      onClick={toggleTheme}\n      className=\"inline-flex cursor-pointer items-center justify-center rounded-lg p-2 text-slate-600 transition hover:-translate-y-0.5 hover:bg-slate-100\"\n      aria-label={`Switch to ${theme === \"light\" ? \"dark\" : \"light\"} theme`}\n      title={`Switch to ${theme === \"light\" ? \"dark\" : \"light\"} theme`}\n    >\n      <div className=\"relative h-5 w-5\">\n        <FiSun\n          className={`absolute inset-0 h-5 w-5 ${\n            theme === \"light\"\n              ? \"opacity-100\"\n              : \"opacity-0\"\n          }`}\n        />\n        <FiMoon\n          className={`absolute inset-0 h-5 w-5 ${\n            theme === \"dark\"\n              ? \"opacity-100\"\n              : \"opacity-0\"\n          }`}\n        />\n      </div>\n    </button>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;;;AAHA;;;AAKe,SAAS;;IACtB,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG,IAAA,2JAAQ;IAEvC,qBACE,4SAAC;QACC,SAAS;QACT,WAAU;QACV,cAAY,CAAC,UAAU,EAAE,UAAU,UAAU,SAAS,QAAQ,MAAM,CAAC;QACrE,OAAO,CAAC,UAAU,EAAE,UAAU,UAAU,SAAS,QAAQ,MAAM,CAAC;kBAEhE,cAAA,4SAAC;YAAI,WAAU;;8BACb,4SAAC,2OAAK;oBACJ,WAAW,CAAC,yBAAyB,EACnC,UAAU,UACN,gBACA,aACJ;;;;;;8BAEJ,4SAAC,4OAAM;oBACL,WAAW,CAAC,yBAAyB,EACnC,UAAU,SACN,gBACA,aACJ;;;;;;;;;;;;;;;;;AAKZ;GA5BwB;;QACS,2JAAQ;;;KADjB"}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///D:/Coding/project/json-flow/jsonflow-web/libs/renders/cytoscape.ts"],"sourcesContent":["import cytoscape, { type Core, type Css, type StylesheetCSS } from \"cytoscape\";\nimport { toCytoscape } from \"@andro.dev/jsonflow-engine\";\n\nexport type LayoutDirection = \"LR\" | \"RL\" | \"TB\" | \"BT\";\n\nexport type GraphLayout = {\n  direction?: LayoutDirection;\n};\n\nexport type MinimalGraph = {\n  layout?: GraphLayout;\n};\n\nexport type MinimalNode = {\n  id: string;\n};\n\nexport type MinimalEdge = {\n  from: string;\n  to: string;\n};\n\nexport type MinimalEngineGraph = {\n  nodes: MinimalNode[];\n  edges: MinimalEdge[];\n};\n\nexport type CytoscapeRenderInput = {\n  container: HTMLElement;\n  graph: MinimalGraph;\n  engineGraph: MinimalEngineGraph;\n  existingCy?: Core | null;\n};\n\nexport type CytoscapeRenderResult =\n  | { ok: true; cy: Core }\n  | { ok: false; error: string };\n\nconst shapeFromData = \"data(shape)\" as unknown as Css.PropertyValueNode<Css.NodeShape>;\n\nexport const CYTOSCAPE_STYLES: StylesheetCSS[] = [\n  {\n    selector: \"node\",\n    css: {\n      \"background-color\": \"#1b4332\",\n      \"border-color\": \"#081c15\",\n      \"border-width\": 2,\n      color: \"#fefae0\",\n      \"font-size\": \"12px\",\n      \"font-weight\": 600,\n      label: \"data(label)\",\n      \"text-wrap\": \"wrap\",\n      \"text-max-width\": \"140px\",\n      \"text-valign\": \"center\",\n      \"text-halign\": \"center\",\n      width: \"label\",\n      padding: \"10px\",\n      \"shape\": \"round-rectangle\",\n    },\n  },\n  {\n    selector: \"node[shape]\",\n    css: {\n      \"shape\": shapeFromData,\n    },\n  },\n  {\n    selector: \"edge\",\n    css: {\n      width: 2,\n      \"curve-style\": \"bezier\",\n      \"line-color\": \"#2d6a4f\",\n      \"target-arrow-color\": \"#2d6a4f\",\n      \"target-arrow-shape\": \"triangle\",\n      label: \"data(label)\",\n      \"font-size\": \"10px\",\n      \"text-rotation\": \"autorotate\",\n      \"text-margin-y\": -8,\n      \"text-background-color\": \"#fefae0\",\n      \"text-background-opacity\": 0.9,\n      \"text-background-padding\": \"2px\",\n    },\n  },\n  {\n    selector: 'edge[link_type = \"dash\"]',\n    css: { \"line-style\": \"dashed\" },\n  },\n  {\n    selector: 'edge[link_type = \"dot\"]',\n    css: { \"line-style\": \"dotted\" },\n  },\n  {\n    selector: 'edge[link_type = \"bold\"]',\n    css: { width: 4 },\n  },\n  {\n    selector: 'edge[link_type = \"double\"]',\n    css: { width: 3 },\n  },\n  {\n    selector: 'edge[link_type = \"open-arrow\"]',\n    css: { \"target-arrow-shape\": \"vee\" },\n  },\n  {\n    selector: 'edge[link_type = \"solid\"]',\n    css: { \"line-style\": \"solid\" },\n  },\n  {\n    selector: 'edge[loop = \"true\"]',\n    css: {\n      \"curve-style\": \"unbundled-bezier\",\n      \"control-point-distance\": 60,\n      \"control-point-weight\": 0.5,\n    },\n  },\n];\n\nconst applyLayoutDirection = (targetCy: Core, direction: LayoutDirection) => {\n  const nodes = targetCy.nodes();\n  if (nodes.length === 0) {\n    return;\n  }\n\n  const positions = nodes.map((node) => node.position());\n  const xs = positions.map((pos) => pos.x);\n  const ys = positions.map((pos) => pos.y);\n  const minX = Math.min(...xs);\n  const maxX = Math.max(...xs);\n  const minY = Math.min(...ys);\n  const maxY = Math.max(...ys);\n  const width = Math.max(1, maxX - minX);\n  const height = Math.max(1, maxY - minY);\n\n  nodes.positions((node) => {\n    const { x, y } = node.position();\n    const nx = x - minX;\n    const ny = y - minY;\n\n    if (direction === \"BT\") {\n      return { x, y: minY + (height - ny) };\n    }\n\n    if (direction === \"LR\") {\n      return { x: minX + ny, y: minY + (width - nx) };\n    }\n\n    if (direction === \"RL\") {\n      return { x: minX + (height - ny), y: minY + nx };\n    }\n\n    return { x, y };\n  });\n\n  targetCy.fit(undefined, 24);\n};\n\nconst detectBackEdges = (\n  nodeIds: string[],\n  edges: { data: { source: string; target: string } }[],\n) => {\n  const state = new Map<string, 0 | 1 | 2>();\n  const outgoing = new Map<string, number[]>();\n  const backEdgeIndexes = new Set<number>();\n\n  nodeIds.forEach((id) => {\n    state.set(id, 0);\n    outgoing.set(id, []);\n  });\n\n  edges.forEach((edge, index) => {\n    const list = outgoing.get(edge.data.source);\n    if (list) {\n      list.push(index);\n    }\n  });\n\n  const dfs = (nodeId: string) => {\n    state.set(nodeId, 1);\n    const edgeIndexes = outgoing.get(nodeId) ?? [];\n    edgeIndexes.forEach((edgeIndex) => {\n      const target = edges[edgeIndex]?.data.target;\n      if (!target) return;\n      const targetState = state.get(target) ?? 0;\n      if (targetState === 0) {\n        dfs(target);\n      } else if (targetState === 1) {\n        backEdgeIndexes.add(edgeIndex);\n      }\n    });\n    state.set(nodeId, 2);\n  };\n\n  nodeIds.forEach((id) => {\n    if ((state.get(id) ?? 0) === 0) {\n      dfs(id);\n    }\n  });\n\n  return backEdgeIndexes;\n};\n\nexport const renderCytoscape = (\n  input: CytoscapeRenderInput,\n): CytoscapeRenderResult => {\n  const elements = toCytoscape(input.engineGraph);\n  const nodeIds = new Set(elements.nodes.map((node) => node.data.id));\n  const filteredEdges = elements.edges.filter((edge) => {\n    const source = edge.data.source;\n    const target = edge.data.target;\n    return Boolean(source) && Boolean(target) && nodeIds.has(source) && nodeIds.has(target);\n  });\n\n  if (filteredEdges.length !== elements.edges.length) {\n    return {\n      ok: false,\n      error: \"Some edges reference missing or empty node ids. Fix them before rendering.\",\n    };\n  }\n\n  const orderedNodeIds = elements.nodes.map((node) => node.data.id);\n  const backEdgeIndexes = detectBackEdges(orderedNodeIds, filteredEdges);\n  const renderedEdges = filteredEdges.map((edge, index) => {\n    if (!backEdgeIndexes.has(index)) {\n      return edge;\n    }\n    return {\n      data: {\n        ...edge.data,\n        loop: \"true\",\n      },\n    };\n  });\n\n  if (input.existingCy) {\n    input.existingCy.destroy();\n  }\n\n  const nextCy = cytoscape({\n    container: input.container,\n    elements: [...elements.nodes, ...renderedEdges],\n    style: CYTOSCAPE_STYLES,\n    layout: {\n      name: \"breadthfirst\",\n      directed: true,\n      padding: 24,\n    },\n  });\n\n  const direction = input.graph.layout?.direction ?? \"LR\";\n  nextCy.ready(() => applyLayoutDirection(nextCy, direction));\n\n  return { ok: true, cy: nextCy };\n};\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 303, "column": 0}, "map": {"version":3,"sources":["file:///D:/Coding/project/json-flow/jsonflow-web/libs/renders/registry.ts"],"sourcesContent":["import type { RenderInput, RenderResult, RendererId } from \"@/libs/renders/types\";\nimport { renderCytoscape } from \"@/libs/renders/cytoscape\";\n\nexport type RendererDefinition = {\n  id: RendererId;\n  label: string;\n  render: (input: RenderInput) => RenderResult;\n};\n\nexport const RENDERERS: Record<RendererId, RendererDefinition> = {\n  cytoscape: {\n    id: \"cytoscape\",\n    label: \"Cytoscape\",\n    render: renderCytoscape,\n  },\n};\n\nexport const getRenderer = (id: RendererId) => RENDERERS[id];\n"],"names":[],"mappings":";;;;;;AACA;;AAQO,MAAM,YAAoD;IAC/D,WAAW;QACT,IAAI;QACJ,OAAO;QACP,QAAQ,qKAAe;IACzB;AACF;AAEO,MAAM,cAAc,CAAC,KAAmB,SAAS,CAAC,GAAG"}},
    {"offset": {"line": 326, "column": 0}, "map": {"version":3,"sources":["file:///D:/Coding/project/json-flow/jsonflow-web/features/workspace/components/EditorInterface.tsx"],"sourcesContent":["\"use client\";\n\nimport Editor, { type OnMount } from \"@monaco-editor/react\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport type { EditorInterfaceProps } from \"@/features/workspace/types/ui\";\n\nconst jsonSchema = {\n  $schema: \"http://json-schema.org/draft-07/schema#\",\n  type: \"object\",\n  required: [\"nodes\", \"edges\"],\n  additionalProperties: false,\n  properties: {\n    type: { enum: [\"graph\", \"sequence\", \"flow\"], default: \"flow\" },\n    layout: {\n      type: \"object\",\n      additionalProperties: false,\n      properties: {\n        direction: { enum: [\"LR\", \"RL\", \"TB\", \"BT\"], default: \"LR\" },\n      },\n    },\n    nodes: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        required: [\"id\"],\n        additionalProperties: false,\n        properties: {\n          id: { type: \"string\", minLength: 1 },\n          label: { type: \"string\" },\n          type: { type: \"string\" },\n          kind: {\n            enum: [\"actor\", \"lifeline\", \"message\", \"activity\", \"state\", \"class\"],\n          },\n          shape: {\n            enum: [\n              \"ellipse\",\n              \"rectangle\",\n              \"round-rectangle\",\n              \"diamond\",\n              \"hexagon\",\n              \"triangle\",\n            ],\n          },\n          properties: { type: \"object\", additionalProperties: true },\n        },\n      },\n    },\n    edges: {\n      type: \"array\",\n      items: {\n        type: \"object\",\n        required: [\"from\", \"to\"],\n        additionalProperties: false,\n        properties: {\n          from: { type: \"string\", minLength: 1 },\n          to: { type: \"string\", minLength: 1 },\n          label: { type: \"string\" },\n          kind: {\n            enum: [\n              \"next\",\n              \"call\",\n              \"return\",\n              \"async\",\n              \"transition\",\n              \"inherit\",\n              \"association\",\n            ],\n          },\n          link_type: {\n            enum: [\"solid\", \"dash\", \"dot\", \"double\", \"bold\", \"arrow\", \"open-arrow\"],\n          },\n        },\n      },\n    },\n  },\n} as const;\n\nconst handleEditorMount: OnMount = (editor, monaco) => {\n  monaco.languages.json.jsonDefaults.setDiagnosticsOptions({\n    validate: true,\n    allowComments: false,\n    schemas: [\n      {\n        uri: \"jsonflow-schema.json\",\n        fileMatch: [\"*\"],\n        schema: jsonSchema,\n      },\n    ],\n  });\n\n  editor.addCommand(monaco.KeyMod.CtrlCmd | monaco.KeyCode.Enter, () => {\n    const event = new CustomEvent(\"jsonflow:render\");\n    window.dispatchEvent(event);\n  });\n};\n\nexport default function EditorInterface({\n  value,\n  status,\n  errorMessage,\n  semanticIssues,\n  onChange,\n  onRender,\n}: EditorInterfaceProps) {\n  const { theme } = useTheme();\n  const issues = semanticIssues ?? [];\n  const issueDetail =\n    issues.length === 0\n      ? null\n      : issues[0].type === \"edge-missing-node\"\n        ? `Missing node \"${issues[0].missing}\" referenced by edge ${issues[0].edge.from} → ${issues[0].edge.to}.`\n        : `Unreachable node \"${issues[0].nodeId}\".`;\n\n  return (\n    <section className=\"relative flex h-full flex-col rounded-2xl border bg-white p-5 shadow-sm\" style={{ borderColor: 'var(--border)', backgroundColor: 'var(--bg-primary)' }}>\n      <div className=\"flex flex-wrap items-start justify-between gap-4\">\n        <div>\n          <div className=\"flex items-center gap-3\">\n            <h2 className=\"text-lg font-semibold\" style={{ color: 'var(--text-primary)' }}>JSON Editor</h2>\n            <span className=\"rounded-full border px-3 py-1 text-[10px] uppercase tracking-[0.3em]\" style={{ borderColor: 'var(--border)', color: 'var(--text-muted)' }}>\n              Monaco\n            </span>\n          </div>\n          <div className=\"mt-2 text-xs\" style={{ color: 'var(--text-muted)' }}>\n            {status === \"ok\" ? \"Schema valid\" : errorMessage ?? \"Schema error\"}\n          </div>\n        </div>\n        <div className=\"flex flex-col items-end gap-2\">\n          <span\n            className={`rounded-full px-3 py-1 text-[10px] uppercase tracking-[0.3em] ${\n              status === \"ok\"\n                ? \"border-emerald-200 bg-emerald-50 text-emerald-700\"\n                : \"border-rose-200 bg-rose-50 text-rose-700\"\n            }`}\n            style={{\n              borderColor: status === \"ok\"\n                ? 'var(--accent)'\n                : 'var(--border)',\n              backgroundColor: status === \"ok\"\n                ? 'var(--bg-tertiary)'\n                : 'var(--bg-tertiary)',\n              color: status === \"ok\"\n                ? '#059669'\n                : '#dc2626'\n            }}\n            title={\n              status === \"ok\"\n                ? issueDetail ?? \"Schema valid\"\n                : errorMessage ?? \"Schema error\"\n            }\n          >\n            {status === \"ok\" ? \"Schema OK\" : \"Schema Error\"}\n          </span>\n        </div>\n      </div>\n\n      <div\n        className=\"absolute right-6 top-20 z-10 rounded-xl border px-3 py-2 text-xs text-left shadow-sm\"\n        style={{ borderColor: 'var(--border)', backgroundColor: 'var(--bg-secondary)', color: 'var(--text-secondary)' }}\n      >\n        <div className=\"flex items-center justify-between gap-3\">\n          <span className=\"text-[10px] uppercase tracking-[0.3em]\" style={{ color: 'var(--text-muted)' }}>Semantic</span>\n          <span className=\"rounded-full px-2 py-0.5\" style={{ backgroundColor: 'var(--bg-tertiary)', color: 'var(--text-secondary)' }}>\n            {issues.length === 0 ? \"None\" : `${issues.length} issue${issues.length === 1 ? \"\" : \"s\"}`}\n          </span>\n        </div>\n        {issues.length === 0 ? (\n          <div className=\"mt-2\">No semantic issues detected.</div>\n        ) : (\n          <div className=\"mt-2\">\n            {issueDetail}\n          </div>\n        )}\n      </div>\n\n      <div className=\"mt-4 flex-1 min-h-[520px] overflow-hidden rounded-xl border pt-3\" style={{ borderColor: 'var(--border)', backgroundColor: 'var(--bg-primary)' }}>\n        <Editor\n          height=\"100%\"\n          defaultLanguage=\"json\"\n          value={value}\n          onChange={(nextValue) => onChange(nextValue ?? \"\")}\n          onMount={handleEditorMount}\n          theme={theme === 'dark' ? 'vs-dark' : 'light'}\n          options={{\n            minimap: { enabled: false },\n            fontSize: 14,\n            fontFamily: \"JetBrains Mono\",\n            scrollBeyondLastLine: false,\n            wordWrap: \"on\",\n            quickSuggestions: true,\n            suggestOnTriggerCharacters: true,\n          }}\n        />\n      </div>\n\n      <div className=\"mt-4 flex flex-wrap items-center gap-3 text-sm\" style={{ color: 'var(--text-muted)' }}>\n        <button\n          className=\"cursor-pointer rounded-full px-5 py-2 text-sm font-semibold\"\n          style={{\n            backgroundColor: 'var(--accent)',\n            color: 'var(--bg-primary)'\n          }}\n          onClick={onRender}\n          type=\"button\"\n        >\n          Render Now\n        </button>\n        <span>Press Ctrl / Cmd + Enter to render.</span>\n      </div>\n    </section>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 726, "column": 0}, "map": {"version":3,"sources":["file:///D:/Coding/project/json-flow/jsonflow-web/features/workspace/components/VisualInterface.tsx"],"sourcesContent":["\"use client\";\n\nimport type { VisualInterfaceProps } from \"@/features/workspace/types/ui\";\n\nexport default function VisualInterface({\n  onExport,\n  canExport,\n  stats,\n  isCyclic,\n  containerRef,\n}: VisualInterfaceProps) {\n  return (\n    <section className=\"flex h-full flex-col rounded-2xl border bg-white p-5 shadow-sm\" style={{ borderColor: 'var(--border)', backgroundColor: 'var(--bg-primary)' }}>\n      <div className=\"flex flex-wrap items-center justify-between gap-3\">\n        <div className=\"flex items-center gap-3\">\n          <h2 className=\"text-lg font-semibold\" style={{ color: 'var(--text-primary)' }}>Graph Preview</h2>\n          <span className=\"rounded-full border px-3 py-1 text-[10px] uppercase tracking-[0.3em]\" style={{ borderColor: 'var(--border)', color: 'var(--text-muted)' }}>\n            Cytoscape\n          </span>\n          {isCyclic ? (\n            <span\n              className=\"rounded-full border px-3 py-1 text-[10px] uppercase tracking-[0.3em]\"\n              style={{ borderColor: 'var(--border)', color: 'var(--accent)' }}\n              title=\"Cycle detected in graph\"\n            >\n              Cyclic\n            </span>\n          ) : null}\n        </div>\n        <button\n          className=\"cursor-pointer rounded-full px-4 py-2 text-xs font-semibold uppercase tracking-[0.3em] text-white\"\n          style={{\n            backgroundColor: 'var(--accent)',\n            color: 'var(--bg-primary)',\n            opacity: canExport ? 1 : 0.5,\n            cursor: canExport ? 'pointer' : 'not-allowed'\n          }}\n          onClick={onExport}\n          disabled={!canExport}\n          type=\"button\"\n        >\n          Export PNG\n        </button>\n      </div>\n\n      <div\n        ref={containerRef}\n        className=\"mt-4 min-h-[520px] flex-1 rounded-xl border\"\n        style={{ borderColor: 'var(--border)', backgroundColor: 'var(--bg-primary)' }}\n      />\n\n      <div className=\"mt-4 flex flex-wrap gap-2 text-xs\" style={{ color: 'var(--text-muted)' }}>\n        <span className=\"rounded-full px-3 py-1\" style={{ backgroundColor: 'var(--bg-tertiary)', color: 'var(--text-secondary)' }}>\n          nodes: {stats.nodes}\n        </span>\n        <span className=\"rounded-full px-3 py-1\" style={{ backgroundColor: 'var(--bg-tertiary)', color: 'var(--text-secondary)' }}>\n          edges: {stats.edges}\n        </span>\n      </div>\n    </section>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;;AAIe,SAAS,gBAAgB,EACtC,QAAQ,EACR,SAAS,EACT,KAAK,EACL,QAAQ,EACR,YAAY,EACS;IACrB,qBACE,4SAAC;QAAQ,WAAU;QAAiE,OAAO;YAAE,aAAa;YAAiB,iBAAiB;QAAoB;;0BAC9J,4SAAC;gBAAI,WAAU;;kCACb,4SAAC;wBAAI,WAAU;;0CACb,4SAAC;gCAAG,WAAU;gCAAwB,OAAO;oCAAE,OAAO;gCAAsB;0CAAG;;;;;;0CAC/E,4SAAC;gCAAK,WAAU;gCAAuE,OAAO;oCAAE,aAAa;oCAAiB,OAAO;gCAAoB;0CAAG;;;;;;4BAG3J,yBACC,4SAAC;gCACC,WAAU;gCACV,OAAO;oCAAE,aAAa;oCAAiB,OAAO;gCAAgB;gCAC9D,OAAM;0CACP;;;;;uCAGC;;;;;;;kCAEN,4SAAC;wBACC,WAAU;wBACV,OAAO;4BACL,iBAAiB;4BACjB,OAAO;4BACP,SAAS,YAAY,IAAI;4BACzB,QAAQ,YAAY,YAAY;wBAClC;wBACA,SAAS;wBACT,UAAU,CAAC;wBACX,MAAK;kCACN;;;;;;;;;;;;0BAKH,4SAAC;gBACC,KAAK;gBACL,WAAU;gBACV,OAAO;oBAAE,aAAa;oBAAiB,iBAAiB;gBAAoB;;;;;;0BAG9E,4SAAC;gBAAI,WAAU;gBAAoC,OAAO;oBAAE,OAAO;gBAAoB;;kCACrF,4SAAC;wBAAK,WAAU;wBAAyB,OAAO;4BAAE,iBAAiB;4BAAsB,OAAO;wBAAwB;;4BAAG;4BACjH,MAAM,KAAK;;;;;;;kCAErB,4SAAC;wBAAK,WAAU;wBAAyB,OAAO;4BAAE,iBAAiB;4BAAsB,OAAO;wBAAwB;;4BAAG;4BACjH,MAAM,KAAK;;;;;;;;;;;;;;;;;;;AAK7B;KAzDwB"}},
    {"offset": {"line": 883, "column": 0}, "map": {"version":3,"sources":["file:///D:/Coding/project/json-flow/jsonflow-web/features/workspace/state/workspace-atoms.ts"],"sourcesContent":["import { atom } from \"jotai\";\nimport type { LayoutDirection } from \"@/libs/renders/cytoscape\";\nimport type { SemanticIssue } from \"@/features/workspace/types/ui\";\nimport type { RendererId } from \"@/libs/renders/types\";\n\nexport const starterJson = `{\n  \"type\": \"flow\",\n  \"layout\": { \"direction\": \"LR\" },\n  \"nodes\": [\n    { \"id\": \"editor\", \"label\": \"Editor Layer\" },\n    { \"id\": \"logic\", \"label\": \"Logic Layer\" },\n    { \"id\": \"parser\", \"label\": \"Parser Layer\" },\n    { \"id\": \"visual\", \"label\": \"Visualization Layer\" },\n    { \"id\": \"layout\", \"label\": \"Layout Layer\" }\n  ],\n  \"edges\": [\n    { \"from\": \"editor\", \"to\": \"logic\", \"label\": \"validate\", \"kind\": \"next\", \"link_type\": \"solid\" },\n    { \"from\": \"logic\", \"to\": \"parser\", \"label\": \"transform\", \"kind\": \"next\", \"link_type\": \"solid\" },\n    { \"from\": \"parser\", \"to\": \"visual\", \"label\": \"render-ready\", \"kind\": \"next\", \"link_type\": \"arrow\" },\n    { \"from\": \"visual\", \"to\": \"layout\", \"label\": \"layout\", \"kind\": \"next\", \"link_type\": \"dash\" }\n  ]\n}`;\n\nexport type ParsedState =\n  | {\n      ok: true;\n      graph: { layout?: { direction?: LayoutDirection } };\n      engineGraph: { nodes: { id: string }[]; edges: { from: string; to: string }[] };\n      meta: { isCyclic: boolean };\n      semantic: SemanticIssue[];\n    }\n  | { ok: false; error: unknown };\n\nexport const rawAtom = atom(starterJson);\nexport const debouncedRawAtom = atom(starterJson);\nexport const parsedAtom = atom<ParsedState>({ ok: false, error: null });\nexport const parsedSourceAtom = atom(starterJson);\nexport const errorAtom = atom<string | null>(null);\nexport const errorTypeAtom = atom<\"json\" | \"schema\" | null>(null);\nexport const rendererIdAtom = atom<RendererId>(\"cytoscape\");\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;AAAA;;AAKO,MAAM,cAAc,CAAC;;;;;;;;;;;;;;;;CAgB3B,CAAC;AAYK,MAAM,UAAU,IAAA,kQAAI,EAAC;AACrB,MAAM,mBAAmB,IAAA,kQAAI,EAAC;AAC9B,MAAM,aAAa,IAAA,kQAAI,EAAc;IAAE,IAAI;IAAO,OAAO;AAAK;AAC9D,MAAM,mBAAmB,IAAA,kQAAI,EAAC;AAC9B,MAAM,YAAY,IAAA,kQAAI,EAAgB;AACtC,MAAM,gBAAgB,IAAA,kQAAI,EAA2B;AACrD,MAAM,iBAAiB,IAAA,kQAAI,EAAa"}},
    {"offset": {"line": 937, "column": 0}, "map": {"version":3,"sources":["file:///D:/Coding/project/json-flow/jsonflow-web/features/workspace/state/parse-graph.ts"],"sourcesContent":["import { Engine } from \"@andro.dev/jsonflow-engine\";\nimport type { ParsedState } from \"@/features/workspace/state/workspace-atoms\";\n\nconst engine = new Engine();\n\nexport type ParseGraphResult = {\n  parsed: ParsedState;\n  error: string | null;\n  errorType: \"json\" | \"schema\" | null;\n};\n\nexport const parseGraphRaw = (raw: string): ParseGraphResult => {\n  try {\n    const json = JSON.parse(raw);\n    const result = engine.parse(json);\n    if (!result.ok) {\n      const issues = (result.error as { issues?: { path: (string | number)[]; message: string }[] }).issues;\n      if (issues && issues.length > 0) {\n        const first = issues[0];\n        const path = first.path.length > 0 ? first.path.join(\".\") : \"root\";\n        return {\n          parsed: result,\n          errorType: \"schema\",\n          error: `Schema error at ${path}: ${first.message}`,\n        };\n      }\n      return {\n        parsed: result,\n        errorType: \"schema\",\n        error: \"Schema validation failed.\",\n      };\n    }\n    return { parsed: result, errorType: null, error: null };\n  } catch (parseError) {\n    const message = parseError instanceof Error ? parseError.message : \"Invalid JSON\";\n    return {\n      parsed: { ok: false, error: parseError },\n      errorType: \"json\",\n      error: `JSON parse error: ${message}`,\n    };\n  }\n};\n"],"names":[],"mappings":";;;;AAAA;;AAGA,MAAM,SAAS,IAAI,oQAAM;AAQlB,MAAM,gBAAgB,CAAC;IAC5B,IAAI;QACF,MAAM,OAAO,KAAK,KAAK,CAAC;QACxB,MAAM,SAAS,OAAO,KAAK,CAAC;QAC5B,IAAI,CAAC,OAAO,EAAE,EAAE;YACd,MAAM,SAAS,AAAC,OAAO,KAAK,CAAmE,MAAM;YACrG,IAAI,UAAU,OAAO,MAAM,GAAG,GAAG;gBAC/B,MAAM,QAAQ,MAAM,CAAC,EAAE;gBACvB,MAAM,OAAO,MAAM,IAAI,CAAC,MAAM,GAAG,IAAI,MAAM,IAAI,CAAC,IAAI,CAAC,OAAO;gBAC5D,OAAO;oBACL,QAAQ;oBACR,WAAW;oBACX,OAAO,CAAC,gBAAgB,EAAE,KAAK,EAAE,EAAE,MAAM,OAAO,EAAE;gBACpD;YACF;YACA,OAAO;gBACL,QAAQ;gBACR,WAAW;gBACX,OAAO;YACT;QACF;QACA,OAAO;YAAE,QAAQ;YAAQ,WAAW;YAAM,OAAO;QAAK;IACxD,EAAE,OAAO,YAAY;QACnB,MAAM,UAAU,sBAAsB,QAAQ,WAAW,OAAO,GAAG;QACnE,OAAO;YACL,QAAQ;gBAAE,IAAI;gBAAO,OAAO;YAAW;YACvC,WAAW;YACX,OAAO,CAAC,kBAAkB,EAAE,SAAS;QACvC;IACF;AACF"}},
    {"offset": {"line": 989, "column": 0}, "map": {"version":3,"sources":["file:///D:/Coding/project/json-flow/jsonflow-web/features/workspace/state/use-workspace-parse.ts"],"sourcesContent":["import { useEffect } from \"react\";\nimport { useAtom } from \"jotai\";\nimport {\n  debouncedRawAtom,\n  errorAtom,\n  errorTypeAtom,\n  parsedAtom,\n  parsedSourceAtom,\n  rawAtom,\n} from \"@/features/workspace/state/workspace-atoms\";\nimport { parseGraphRaw } from \"@/features/workspace/state/parse-graph\";\n\nexport const useWorkspaceParse = () => {\n  const [raw] = useAtom(rawAtom);\n  const [debouncedRaw, setDebouncedRaw] = useAtom(debouncedRawAtom);\n  const [, setError] = useAtom(errorAtom);\n  const [, setErrorType] = useAtom(errorTypeAtom);\n  const [, setParsed] = useAtom(parsedAtom);\n  const [, setParsedSource] = useAtom(parsedSourceAtom);\n\n  useEffect(() => {\n    const handle = setTimeout(() => setDebouncedRaw(raw), 250);\n    return () => clearTimeout(handle);\n  }, [raw, setDebouncedRaw]);\n\n  useEffect(() => {\n    const result = parseGraphRaw(debouncedRaw);\n    setError(result.error);\n    setErrorType(result.errorType);\n    setParsed(result.parsed);\n    setParsedSource(debouncedRaw);\n  }, [debouncedRaw, setError, setErrorType, setParsed, setParsedSource]);\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AAQA;;;;;;AAEO,MAAM,oBAAoB;;IAC/B,MAAM,CAAC,IAAI,GAAG,IAAA,mQAAO,EAAC,qLAAO;IAC7B,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,mQAAO,EAAC,8LAAgB;IAChE,MAAM,GAAG,SAAS,GAAG,IAAA,mQAAO,EAAC,uLAAS;IACtC,MAAM,GAAG,aAAa,GAAG,IAAA,mQAAO,EAAC,2LAAa;IAC9C,MAAM,GAAG,UAAU,GAAG,IAAA,mQAAO,EAAC,wLAAU;IACxC,MAAM,GAAG,gBAAgB,GAAG,IAAA,mQAAO,EAAC,8LAAgB;IAEpD,IAAA,yRAAS;uCAAC;YACR,MAAM,SAAS;sDAAW,IAAM,gBAAgB;qDAAM;YACtD;+CAAO,IAAM,aAAa;;QAC5B;sCAAG;QAAC;QAAK;KAAgB;IAEzB,IAAA,yRAAS;uCAAC;YACR,MAAM,SAAS,IAAA,uLAAa,EAAC;YAC7B,SAAS,OAAO,KAAK;YACrB,aAAa,OAAO,SAAS;YAC7B,UAAU,OAAO,MAAM;YACvB,gBAAgB;QAClB;sCAAG;QAAC;QAAc;QAAU;QAAc;QAAW;KAAgB;AACvE;GApBa;;QACG,mQAAO;QACmB,mQAAO;QAC1B,mQAAO;QACH,mQAAO;QACV,mQAAO;QACD,mQAAO"}},
    {"offset": {"line": 1056, "column": 0}, "map": {"version":3,"sources":["file:///D:/Coding/project/json-flow/jsonflow-web/features/workspace/components/Workspace.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef, useState } from \"react\";\nimport { useAtom } from \"jotai\";\nimport type { Core } from \"cytoscape\";\nimport { useTheme } from \"@/contexts/ThemeContext\";\nimport {\n  type LayoutDirection,\n} from \"@/libs/renders/cytoscape\";\nimport { getRenderer } from \"@/libs/renders/registry\";\nimport EditorInterface from \"@/features/workspace/components/EditorInterface\";\nimport VisualInterface from \"@/features/workspace/components/VisualInterface\";\nimport type { GraphStats, SchemaStatus } from \"@/features/workspace/types/ui\";\nimport {\n  errorAtom,\n  errorTypeAtom,\n  parsedAtom,\n  parsedSourceAtom,\n  rendererIdAtom,\n  rawAtom,\n} from \"@/features/workspace/state/workspace-atoms\";\nimport { useWorkspaceParse } from \"@/features/workspace/state/use-workspace-parse\";\nimport { parseGraphRaw } from \"@/features/workspace/state/parse-graph\";\n\nexport default function Workspace() {\n  const { theme } = useTheme();\n  const [raw, setRaw] = useAtom(rawAtom);\n  const [error, setError] = useAtom(errorAtom);\n  const [errorType, setErrorType] = useAtom(errorTypeAtom);\n  const [parsed, setParsed] = useAtom(parsedAtom);\n  const [parsedSource, setParsedSource] = useAtom(parsedSourceAtom);\n  const [rendererId] = useAtom(rendererIdAtom);\n  const [cy, setCy] = useState<Core | null>(null);\n  const containerRef = useRef<HTMLDivElement | null>(null);\n  const downloadRef = useRef<HTMLAnchorElement | null>(null);\n\n  useWorkspaceParse();\n\n  const status: SchemaStatus = parsed.ok ? \"ok\" : \"error\";\n  const stats: GraphStats = parsed.ok\n    ? {\n        nodes: parsed.engineGraph.nodes.length,\n        edges: parsed.engineGraph.edges.length,\n      }\n    : { nodes: 0, edges: 0 };\n\n  const renderGraph = () => {\n    if (!containerRef.current) {\n      return;\n    }\n\n    let currentParsed = parsed;\n    let currentError = error;\n    let currentErrorType = errorType;\n\n    if (raw !== parsedSource) {\n      const next = parseGraphRaw(raw);\n      currentParsed = next.parsed;\n      currentError = next.error;\n      currentErrorType = next.errorType;\n      setError(next.error);\n      setErrorType(next.errorType);\n      setParsed(next.parsed);\n      setParsedSource(raw);\n    }\n\n    if (!currentParsed.ok) {\n      if (currentErrorType === \"json\") {\n        setError(currentError ?? \"JSON parse error.\");\n      } else if (currentErrorType === \"schema\") {\n        setError(currentError ?? \"Schema validation failed.\");\n      } else {\n        setError(\"Invalid JSON or schema validation failed.\");\n      }\n      return;\n    }\n\n    setError(null);\n\n    if (currentParsed.semantic.length > 0) {\n      const missing = currentParsed.semantic.find((issue) => issue.type === \"edge-missing-node\");\n      if (missing && missing.type === \"edge-missing-node\") {\n        setError(\n          `Edge ${missing.edge.from} → ${missing.edge.to} references missing node \"${missing.missing}\".`,\n        );\n        return;\n      }\n    }\n\n    if (cy) {\n      cy.destroy();\n    }\n\n    const renderer = getRenderer(rendererId);\n    const result = renderer.render({\n      container: containerRef.current,\n      graph: currentParsed.graph,\n      engineGraph: currentParsed.engineGraph,\n      existingCy: cy,\n    });\n    if (!result.ok) {\n      setError(result.error);\n      return;\n    }\n\n    setCy(result.cy);\n  };\n\n  const exportImage = () => {\n    if (!cy) {\n      setError(\"Render a graph before exporting.\");\n      return;\n    }\n\n    const bgColor = theme === 'dark' ? '#0f172a' : '#ffffff';\n    const png = cy.png({ full: true, bg: bgColor });\n    if (downloadRef.current) {\n      downloadRef.current.href = png;\n      downloadRef.current.download = \"jsonflow-graph.png\";\n      downloadRef.current.click();\n    }\n  };\n\n  useEffect(() => {\n    const handler = () => renderGraph();\n    window.addEventListener(\"jsonflow:render\", handler);\n    return () => window.removeEventListener(\"jsonflow:render\", handler);\n  }, [parsed.ok, raw, error, errorType]);\n\n  return (\n    <main className=\"grid w-full flex-1 items-stretch gap-6 px-6 py-6 md:grid-cols-2\">\n      <a ref={downloadRef} className=\"hidden\" />\n      <EditorInterface\n        value={raw}\n        status={status}\n        errorMessage={error}\n        semanticIssues={parsed.ok ? parsed.semantic : undefined}\n        onChange={setRaw}\n        onRender={renderGraph}\n      />\n      <VisualInterface\n        onExport={exportImage}\n        canExport={Boolean(cy)}\n        stats={stats}\n        isCyclic={parsed.ok ? parsed.meta.isCyclic : undefined}\n        containerRef={containerRef}\n      />\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}